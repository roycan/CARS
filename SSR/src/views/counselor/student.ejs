<div class="content">
    <nav class="breadcrumb">
        <ul>
            <li><a href="/counselor/dashboard">Dashboard</a></li>
            <li class="is-active"><a><%= student.name %></a></li>
        </ul>
    </nav>
    
    <h1 class="title"><%= student.name %></h1>
    
    <!-- Student Information -->
    <div class="box">
        <h3 class="title is-5">Student Information</h3>
        <div class="columns">
            <div class="column">
                <p><strong>Email:</strong> <%= student.email %></p>
                <p><strong>Section:</strong> <%= student.section %></p>
            </div>
            <div class="column">
                <p><strong>Batch:</strong> <%= student.batch %></p>
                <p><strong>School:</strong> <%= student.school || 'Not specified' %></p>
            </div>
        </div>
    </div>
    
    <!-- Assessment History -->
    <div class="box">
        <h3 class="title is-5">Assessment History</h3>
        
        <% if (assessments.length === 0) { %>
            <div class="notification is-info">
                <p>No assessments completed yet.</p>
            </div>
        <% } else { %>
            <div class="table-container">
                <table class="table is-fullwidth is-striped">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Risk Level</th>
                            <th>Total T-Score</th>
                            <th>Self-Harm</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% assessments.forEach(assessment => { %>
                            <tr>
                                <td><%= new Date(assessment.taken_at).toLocaleDateString() %></td>
                                <td>
                                    <span class="tag risk-<%= assessment.risk_level %>">
                                        <% if (assessment.risk_level === 'normal') { %>Normal
                                        <% } else if (assessment.risk_level === 'at-risk') { %>At-Risk
                                        <% } else { %>High Risk<% } %>
                                    </span>
                                </td>
                                <td><strong><%= JSON.parse(assessment.t_scores).total %></strong></td>
                                <td>
                                    <% if (assessment.self_harm_flagged) { %>
                                        <span class="tag is-danger">⚠️ Yes</span>
                                    <% } else { %>
                                        <span class="tag is-success">No</span>
                                    <% } %>
                                </td>
                                <td>
                                    <button class="button is-small is-info" 
                                            onclick="showAssessmentDetails(<%= assessment.id %>)">
                                        View Details
                                    </button>
                                </td>
                            </tr>
                        <% }) %>
                    </tbody>
                </table>
            </div>
        <% } %>
    </div>
    
    <!-- Latest Assessment Details -->
    <% if (assessments.length > 0) { %>
        <% const latest = assessments[0]; %>
        <% const tScores = JSON.parse(latest.t_scores); %>
        <div class="box">
            <h3 class="title is-5">Latest Assessment Details</h3>
            <p class="subtitle is-6">Taken on <%= new Date(latest.taken_at).toLocaleDateString() %></p>
            
            <div class="columns is-multiline">
                <div class="column is-6">
                    <div class="box has-text-centered">
                        <h4 class="title is-6">Externalizing</h4>
                        <p class="title is-4"><%= tScores.externalizing %></p>
                    </div>
                </div>
                <div class="column is-6">
                    <div class="box has-text-centered">
                        <h4 class="title is-6">Internalizing</h4>
                        <p class="title is-4"><%= tScores.internalizing %></p>
                    </div>
                </div>
                <div class="column is-6">
                    <div class="box has-text-centered">
                        <h4 class="title is-6">Social</h4>
                        <p class="title is-4"><%= tScores.social %></p>
                    </div>
                </div>
                <div class="column is-6">
                    <div class="box has-text-centered">
                        <h4 class="title is-6">Academic/Learning</h4>
                        <p class="title is-4"><%= tScores.academic %></p>
                    </div>
                </div>
                <div class="column is-12">
                    <div class="box has-text-centered risk-<%= latest.risk_level %>">
                        <h4 class="title is-5">Total Score</h4>
                        <p class="title is-2"><%= tScores.total %></p>
                    </div>
                </div>
            </div>
            
            <div class="notification risk-<%= latest.risk_level %>">
                <p><strong>Interpretation:</strong> <%= latest.interpretation %></p>
            </div>
        </div>
    <% } %>
    
    <div class="buttons">
        <a href="/counselor/dashboard" class="button is-primary">Back to Dashboard</a>
    </div>
</div>

<!-- Assessment Details Modal -->
<div class="modal" id="assessmentModal">
    <div class="modal-background"></div>
    <div class="modal-card">
        <header class="modal-card-head">
            <p class="modal-card-title">Assessment Details</p>
            <button class="delete" onclick="closeModal()"></button>
        </header>
        <section class="modal-card-body" id="modalContent">
            <!-- Content loaded via JavaScript -->
        </section>
        <footer class="modal-card-foot">
            <button class="button" onclick="closeModal()">Close</button>
        </footer>
    </div>
</div>

<script>
function showAssessmentDetails(assessmentId) {
    // In a real implementation, this would fetch assessment details via AJAX
    document.getElementById('assessmentModal').classList.add('is-active');
    document.getElementById('modalContent').innerHTML = '<p>Assessment details would be loaded here...</p>';
}

function closeModal() {
    document.getElementById('assessmentModal').classList.remove('is-active');
}
</script>