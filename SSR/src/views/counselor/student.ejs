<nav class="breadcrumb" aria-label="breadcrumbs">
  <ul>
    <li><a href="/counselor/dashboard">Dashboard</a></li>
    <li class="is-active"><a href="#" aria-current="page"><%= student.name %></a></li>
  </ul>
</nav>

<h1 class="title">Student Details</h1>

<!-- Student Information -->
<div class="box">
  <h2 class="title is-4">Student Information</h2>
  <div class="columns">
    <div class="column">
      <p><strong>Name:</strong> <%= student.name %></p>
      <p><strong>Email:</strong> <%= student.email %></p>
    </div>
    <div class="column">
      <p><strong>Section:</strong> <%= student.section %></p>
      <p><strong>Batch:</strong> <%= student.batch %></p>
      <% if (student.school) { %>
        <p><strong>School:</strong> <%= student.school %></p>
      <% } %>
    </div>
  </div>
</div>

<!-- Assessment History -->
<h2 class="title is-4">Assessment History (<%= assessments.length %>)</h2>

<% if (assessments.length === 0) { %>
  <div class="notification is-light">
    No assessments found for this student.
  </div>
<% } else { %>
  <% assessments.forEach((assessment, index) => { %>
    <div class="box <%= assessment.self_harm_flagged ? 'has-background-danger-light' : '' %>">
      <div class="level">
        <div class="level-left">
          <div class="level-item">
            <div>
              <p class="heading">Assessment Date</p>
              <p class="title is-5"><%= new Date(assessment.taken_at).toLocaleString() %></p>
            </div>
          </div>
          <div class="level-item">
            <div>
              <p class="heading">Risk Level</p>
              <p class="title is-5">
                <span class="risk-badge risk-<%= assessment.risk_level === 'High risk' ? 'high' : assessment.risk_level === 'At-risk' ? 'at-risk' : 'normal' %>">
                  <%= assessment.risk_level %>
                </span>
              </p>
            </div>
          </div>
          <div class="level-item">
            <div>
              <p class="heading">Total T-Score</p>
              <p class="title is-5"><%= assessment.t_scores.total %></p>
            </div>
          </div>
        </div>
      </div>

      <% if (assessment.self_harm_flagged) { %>
        <div class="notification is-danger">
          <strong>⚠️ Self-Harm Alert:</strong> This student indicated thoughts of self-harm. 
          Immediate follow-up is required.
        </div>
      <% } %>

      <div class="content">
        <p><strong>Interpretation:</strong> <%= assessment.interpretation %></p>
        
        <details class="mt-4">
          <summary class="button is-small is-outlined">View Detailed Scores</summary>
          <div class="mt-3">
            <div class="columns is-multiline">
              <div class="column is-3">
                <div class="box has-text-centered">
                  <p class="heading">Externalizing</p>
                  <p class="title is-4"><%= assessment.t_scores.externalizing %></p>
                  <p class="help">Raw: <%= assessment.raw_scores.externalizing %></p>
                </div>
              </div>
              <div class="column is-3">
                <div class="box has-text-centered">
                  <p class="heading">Internalizing</p>
                  <p class="title is-4"><%= assessment.t_scores.internalizing %></p>
                  <p class="help">Raw: <%= assessment.raw_scores.internalizing %></p>
                </div>
              </div>
              <div class="column is-3">
                <div class="box has-text-centered">
                  <p class="heading">Social</p>
                  <p class="title is-4"><%= assessment.t_scores.social %></p>
                  <p class="help">Raw: <%= assessment.raw_scores.social %></p>
                </div>
              </div>
              <div class="column is-3">
                <div class="box has-text-centered">
                  <p class="heading">Academic</p>
                  <p class="title is-4"><%= assessment.t_scores.academic %></p>
                  <p class="help">Raw: <%= assessment.raw_scores.academic %></p>
                </div>
              </div>
            </div>
          </div>
        </details>
      </div>
    </div>
  <% }); %>
<% } %>

<div class="field is-grouped mt-5">
  <div class="control">
    <a href="/counselor/dashboard" class="button is-primary">
      ← Back to Dashboard
    </a>
  </div>
</div>
