<div class="content">
    <h1 class="title">Counselor Dashboard</h1>
    <p class="subtitle">Assessment overview and student management</p>
    
    <!-- Statistics Overview -->
    <div class="columns is-multiline dashboard-stats">
        <div class="column is-3">
            <div class="box">
                <h3 class="title is-4"><%= stats.total_assessments %></h3>
                <p class="subtitle is-6">Total Assessments</p>
            </div>
        </div>
        <div class="column is-3">
            <div class="box">
                <h3 class="title is-4"><%= stats.unique_students %></h3>
                <p class="subtitle is-6">Students Assessed</p>
            </div>
        </div>
        <div class="column is-3">
            <div class="box risk-high">
                <h3 class="title is-4"><%= stats.high_risk_count %></h3>
                <p class="subtitle is-6">High Risk</p>
            </div>
        </div>
        <div class="column is-3">
            <div class="box">
                <h3 class="title is-4"><%= stats.self_harm_count %></h3>
                <p class="subtitle is-6">Self-Harm Flagged</p>
            </div>
        </div>
    </div>
    
    <!-- Risk Level Breakdown -->
    <div class="box">
        <h3 class="title is-5">Risk Level Distribution</h3>
        <div class="columns">
            <div class="column">
                <div class="notification risk-normal">
                    <strong>Normal/No Risk:</strong> <%= stats.normal_count %> students
                </div>
            </div>
            <div class="column">
                <div class="notification risk-at-risk">
                    <strong>At-Risk:</strong> <%= stats.at_risk_count %> students
                </div>
            </div>
            <div class="column">
                <div class="notification risk-high">
                    <strong>High Risk:</strong> <%= stats.high_risk_count %> students
                </div>
            </div>
        </div>
    </div>
    
    <!-- Student List -->
    <div class="box">
        <div class="level">
            <div class="level-left">
                <h3 class="title is-5">Students</h3>
            </div>
            <div class="level-right">
                <div class="field has-addons">
                    <div class="control">
                        <div class="select">
                            <select id="sectionFilter">
                                <option value="">All Sections</option>
                                <% sections.forEach(section => { %>
                                    <option value="<%= section %>"><%= section %></option>
                                <% }) %>
                            </select>
                        </div>
                    </div>
                    <div class="control">
                        <div class="select">
                            <select id="riskFilter">
                                <option value="">All Risk Levels</option>
                                <option value="normal">Normal</option>
                                <option value="at-risk">At-Risk</option>
                                <option value="high">High Risk</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="table-container">
            <table class="table is-fullwidth is-striped student-list">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Section</th>
                        <th>Batch</th>
                        <th>Latest Risk Level</th>
                        <th>Last Assessment</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <% students.forEach(student => { %>
                        <tr data-section="<%= student.section %>" 
                            data-risk="<%= student.risk_level || 'none' %>">
                            <td><strong><%= student.name %></strong></td>
                            <td><%= student.section %></td>
                            <td><%= student.batch %></td>
                            <td>
                                <% if (student.risk_level) { %>
                                    <span class="tag risk-<%= student.risk_level %>">
                                        <% if (student.risk_level === 'normal') { %>Normal
                                        <% } else if (student.risk_level === 'at-risk') { %>At-Risk
                                        <% } else { %>High Risk<% } %>
                                    </span>
                                    <% if (student.self_harm_flagged) { %>
                                        <span class="tag is-danger">⚠️ Self-Harm</span>
                                    <% } %>
                                <% } else { %>
                                    <span class="tag is-light">No Assessment</span>
                                <% } %>
                            </td>
                            <td>
                                <% if (student.last_assessment) { %>
                                    <%= new Date(student.last_assessment).toLocaleDateString() %>
                                <% } else { %>
                                    Never
                                <% } %>
                            </td>
                            <td>
                                <a href="/counselor/student/<%= student.id %>" 
                                   class="button is-small is-info">View Details</a>
                            </td>
                        </tr>
                    <% }) %>
                </tbody>
            </table>
        </div>
    </div>
</div>

<script>
// Filter functionality
document.addEventListener('DOMContentLoaded', function() {
    const sectionFilter = document.getElementById('sectionFilter');
    const riskFilter = document.getElementById('riskFilter');
    const rows = document.querySelectorAll('tbody tr');
    
    function filterTable() {
        const sectionValue = sectionFilter.value;
        const riskValue = riskFilter.value;
        
        rows.forEach(row => {
            const section = row.dataset.section;
            const risk = row.dataset.risk;
            
            const sectionMatch = !sectionValue || section === sectionValue;
            const riskMatch = !riskValue || risk === riskValue;
            
            row.style.display = sectionMatch && riskMatch ? '' : 'none';
        });
    }
    
    sectionFilter.addEventListener('change', filterTable);
    riskFilter.addEventListener('change', filterTable);
});
</script>