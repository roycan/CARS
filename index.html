<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CARS Self-Assessment Tool</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css" />
    <link rel="stylesheet" href="styles.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <nav class="navbar is-primary" role="navigation" aria-label="main navigation">
        <div class="navbar-brand">
            <a class="navbar-item" href="#"><strong>CARS Tracker</strong></a>
        </div>
        <div class="navbar-menu">
            <div class="navbar-start">
                <a class="navbar-item" data-view="test">‚úçÔ∏è New Test</a>
                <a class="navbar-item" data-view="calendar">üóìÔ∏è Calendar</a>
                <a class="navbar-item" data-view="analysis">üìä Analysis</a>
                <a class="navbar-item" data-view="data">üíæ Data Management</a>
            </div>
            <div class="navbar-end pr-4">
                <a id="dev-mode-toggle" class="navbar-item has-text-weight-semibold" title="Toggle Dev Mode">Dev Mode</a>
            </div>
        </div>
    </nav>

    <main class="container mt-4">
        <section id="view-test" class="view is-active">
            <h1 class="title">New Assessment</h1>
            <p class="subtitle">Rate each item based on your experiences in the <strong>past month</strong>.</p>
            <div id="questionnaire-form"></div>
            <button id="submit-test" class="button is-primary is-large mt-4">View My Results</button>
        </section>
        <section id="view-calendar" class="view">
            <div class="level">
                <div class="level-left"><h1 class="title">History Calendar</h1></div>
                <div class="level-right">
                    <button id="prev-month" class="button">‚óÑ Prev</button>
                    <h2 id="calendar-month-year" class="title is-4 mx-4"></h2>
                    <button id="next-month" class="button">Next ‚ñ∫</button>
                </div>
            </div>
            <div id="calendar-grid" class="is-grid" style="display:grid;grid-template-columns:repeat(7,1fr);">
                <div class="has-text-centered has-text-weight-bold p-2">Sun</div>
                <div class="has-text-centered has-text-weight-bold p-2">Mon</div>
                <div class="has-text-centered has-text-weight-bold p-2">Tue</div>
                <div class="has-text-centered has-text-weight-bold p-2">Wed</div>
                <div class="has-text-centered has-text-weight-bold p-2">Thu</div>
                <div class="has-text-centered has-text-weight-bold p-2">Fri</div>
                <div class="has-text-centered has-text-weight-bold p-2">Sat</div>
            </div>
        </section>
        <section id="view-analysis" class="view">
            <h1 class="title">Analysis</h1>
            <div class="columns">
                <div class="column is-two-thirds"><div class="box"><h2 class="subtitle">Trends Over Time (T-Scores)</h2><canvas id="trends-chart"></canvas></div></div>
                <div class="column is-one-third"><div class="box"><h2 class="subtitle">Most Recent Test Snapshot</h2><canvas id="snapshot-chart"></canvas></div></div>
            </div>
        </section>
        <section id="view-data" class="view">
            <h1 class="title">Data Management</h1>
            <div class="notification is-light is-info mb-4">
                <strong>Tip:</strong> Export regularly so you can restore your progress if you clear browser storage.
            </div>
            <div class="columns is-multiline">
                <div class="column is-4">
                    <div class="box">
                        <h2 class="subtitle">1. Export</h2>
                        <p class="is-size-7 mb-2">Keep a backup (JSON) or share with a counselor (CSV).</p>
                        <div class="buttons is-flex is-flex-direction-column is-align-items-stretch">
                            <button id="export-json" class="button is-info mb-2">‚¨á JSON Backup</button>
                            <button id="export-csv" class="button is-success">‚¨á CSV (Summary)</button>
                        </div>
                    </div>
                </div>
                <div class="column is-4">
                    <div class="box">
                        <h2 class="subtitle">2. Import</h2>
                        <p class="is-size-7 mb-2">Load a previous JSON backup. This will <strong>replace</strong> current data.</p>
                        <div class="file has-name is-fullwidth mt-2" id="import-wrapper">
                            <label class="file-label is-fullwidth">
                                <input id="import-json-input" class="file-input" type="file" accept="application/json" />
                                <span class="file-cta">
                                    <span class="file-icon">üìÅ</span>
                                    <span class="file-label">Choose JSON‚Ä¶</span>
                                </span>
                                <span class="file-name" id="import-file-name">No file selected</span>
                            </label>
                        </div>
                    </div>
                </div>
                <div class="column is-4">
                    <div class="box danger-zone">
                        <h2 class="subtitle has-text-danger">3. Danger Zone</h2>
                        <p class="is-size-7 mb-2">Erase everything stored in this browser.</p>
                        <button id="delete-all" class="button is-danger is-fullwidth">üóë Delete All Data</button>
                    </div>
                </div>
            </div>
            <div class="box mt-2" id="data-stats">
                <h2 class="subtitle">Stored Data Summary</h2>
                <p class="is-size-7">Loading stats‚Ä¶</p>
            </div>
            <p class="is-size-7 has-text-grey mt-4"><strong>Privacy:</strong> All data stays only in <em>your browser's</em> local storage. No servers. Clearing your browser storage or using another device will remove it unless you export a backup first.</p>
        </section>
    </main>

    <div id="results-modal" class="modal">
        <div class="modal-background"></div>
        <div class="modal-card">
            <header class="modal-card-head">
                <p class="modal-card-title">Assessment Results</p>
                <button class="delete" aria-label="close"></button>
            </header>
            <section class="modal-card-body"><div id="modal-content"></div></section>
            <footer class="modal-card-foot"><button class="button">Close</button></footer>
        </div>
    </div>

    <div id="dev-mode-panel" class="mt-5"><h3 class="title is-6 mb-2">Dev Mode</h3><div id="dev-mode-content" class="content is-size-7">Inactive.</div></div>

    <script src="js/data.js"></script>
    <script src="js/scoring.js"></script>
    <script src="js/storage.js"></script>
    <script src="js/ui_questionnaire.js"></script>
    <script src="js/ui_modal.js"></script>
    <script src="js/ui_calendar.js"></script>
    <script src="js/ui_analysis.js"></script>
    <script src="js/devmode.js"></script>
    <script src="js/main.js"></script>
</body>
</html>